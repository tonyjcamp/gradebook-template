<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title>All Grades</title>

		<meta name="viewport" content="width=device-width">

		<link rel="stylesheet" href="css/bootstrap.css">
		<link rel="stylesheet" href="css/style.css">

	</head>
	<body>
		<header id="all-grades-header" class="clearfix">
			<h1 class="fl">All Grades</h1>
			<div id="course-average" class="fl">
				<p>Course Average: <span class="grade-value">B+</span></p>
			</div><!-- /course-average -->
			<dl id="export-options" class="fr clearfix">
				<dt class="fl">Export:</dt>
				<dd><button type="button" class="faux-link">PDF</button></dd>
				<dd><button type="button" class="faux-link">CSV</button></dd>
				<dd><button type="button" class="faux-link">XLS</button></dd>
			</dl>
		</header><!-- /header -->

		<div id="sorting-options" class="clearfix">
			<div id="view" class="fl">
				View:
				<select name="sections">
					<option value="all">All Sections/Groups</option>
				</select>
				<select id="category-dropdown" name="categories">
					<!-- populated based on JSON data -->
				</select>
			</div>
			<div id="filtering" class="fl">
				<label class="fl">Filter: </label><input type="text" name="filter" value="" placeholder="Student Name" class="filter-by fl" />
				<button type="submit" class="btn fl submit">Show</button>
				<button type="reset" class="hidden">x</button>
			</div><!-- /filtering -->
			<div id="pagination" class="fr">
				<button type="button" class="btn fl">&lt;&lt;</button>
				<button type="button" class="btn fl">&lt;</button>
				<select name="num-of-pages" class="fl">
					<option value="5">Show 5</option>
					<option value="10">Show 10</option>
					<option value="20">Show 20</option>
					<option value="50">Show 50</option>
					<option value="100">Show 100</option>
					<option value="all">Show All</option>
				</select>
				<button type="button" class="btn fl">&gt;</button>
				<button type="button" class="btn fl">&gt;&gt;</button>
			</div><!-- /pagination -->
			<div id="show-cols" class="clearfix">
				<button type="button" class="faux-link">Hide/Show columns</button>
			</div><!-- /show-cols -->
		</div><!-- /sorting-options -->

		<!-- data table -->
		<table id="gradebook-container">
			<thead>
				<tr id="col-header" class="header">

				</tr>
			</thead>
			<tbody id="gradebook-data">

			</tbody>
		</table>

		<div id="legend" class="">
			<button type="button" class="faux-link">Show Legend</button>
			<ul id="legend-content" class="hidden">
				<li>* Grades in parentheses () are not included in the category average or course grade calculations.</li>
				<li>** Items with a grey background are not released to students.</li>
				<li>Dropped grades are struck out.</li>
			</ul><!-- /legend-content -->
			
		</div><!-- /legend -->

 <!-- doT.js templating -->
  
  <!-- Column Headers (th) -->
  <script id="header-tmpl" type="text/x-dot-template">
	{{~it.headers :value:index}}
	<th>{{=value}}</th>
	{{~}}			
  </script>

  <!-- each grade row -->
  <script id="row-tmpl" type="text/x-dot-template">
  	/*{{ console.log(it); }}*/
  	{{ var students = Object.keys(it.users); }}

	{{ for (var i = 0, l = students.length; i < l; i++) { }}
	<tr>
	  /* Partial template 'student-info' */
	  {{#def.studentInfo}}

	  /* Category Score */
	  {{#def.categories}}

	</tr>
	{{ } }}

  </script>

  <script id="students-tmpl" type="text/x-dot-template">
	<td class="name">{{=it.users[students[i]].sortName}}</td>
	<td class="username">{{=it.users[students[i]].displayId}}</td>
	<td class="class-grade">{{=students[i].classGrade}}</td>
  </script>

  <!-- include for row-tmpl -->
  <script id="assignments-tmpl" type="text/x-dot-template">

	/* loop through categories */
	

		/* Just making a nice refence to the current grade in the array */	
		{{ var assignmentsObj = it.users[students[i]].grades; }}
		{{ var assignmentsInCategory = it.categories[categoryId[x]].assignments; }}

		/* loop through the grades for each student */
		{{ for (var k = 0; k < assignmentsInCategory.length; k++) { }}

			/* 	If the current assignment (j) in the category grades array matches the current assignment
			in the student loop, let's break out of this loop so we can output the Category grade located
			in the categories-tmpl
			*/
				<td>{{=assignmentsObj[assignmentsInCategory[k]].points}}</td>

		{{ } }}
	/*{{ } }}*/
  </script>

  <!-- Template for the category grade column -->
  <script id="categories-tmpl" type="text/x-dot-template">

	/*	This is only output when we have reached the last grade in the categories > key > grades array
	The logic to break out of the assignment loop and output the grade is located in the
	assignments-tmpl
	*/
  	{{ var categoryId = Object.keys(it.categories); }}

	{{ for (var x = 0; x < categoryId.length; x++) { }}

		/* This variable is referenced in the assignments-tmpl */
		{{ var categoryName = categoryId[x]; }}

		/* bring in our assinments template*/
		{{#def.assignments}}

		/* output our category grade */	
		/* need to know where this will be pulled from */
		<td class="category-grade">{{=it.categories[categoryId[x]].name }}</td>

	{{ } }}

  </script>

  <!-- Template for the category dropdown filter -->
  <script id="category-dropdown-tmpl" type="text/x-dot-template">
	{{ var getCategories = function() { }}
		{{ var categoryObjs = []; }}
		{{ for (var cat = 0; cat < Object.keys(it.categories).length; cat++) { }}
			{{ var category = Object.keys(it.categories)[cat]; }}
			
			{{ categoryObjs.push(it.categories[Object.keys(it.categories)[cat]].name); }}

		{{ } }}
		
		{{ return categoryObjs; }}
		
		{{ }; }}
	}}

	{{ 	
		var categories = getCategories();
		var options = '<option value="all">All Sections/Groups</option>';
	}}

	{{ for (var i = 0; i < categories.length; i++) { }}
	
		{{ options += '<option value="{{=categories[i].id}}"> {{=categories[i]}} </option>' }}

	{{ } }}

	{{=options }}

  </script>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/libs/jquery-1.7.2.min.js"><\/script>')</script>

	<script src="js/plugins.js"></script>

	<!-- JSON Model Called Here -->
	<script src="js/student.js"></script>

	<!-- Our Templating Lib -->
	<script src="js/libs/doT.js"></script>

	<script src="js/script.js"></script>

	</body>
</html>
